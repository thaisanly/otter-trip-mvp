%%{init: {'theme':'default', 'themeVariables': { 'primaryColor': '#ff6b35', 'primaryTextColor': '#fff', 'primaryBorderColor': '#ff6b35', 'lineColor': '#333', 'secondaryColor': '#006b6b', 'tertiaryColor': '#fff'}}}%%

graph TB
    subgraph "User Management"
        users[USERS<br/>- id: UUID PK<br/>- email: VARCHAR<br/>- username: VARCHAR<br/>- profile_image: VARCHAR<br/>- travel_style: JSONB<br/>- interests: JSONB]
        
        tour_leaders[TOUR_LEADERS<br/>- id: UUID PK<br/>- user_id: FK<br/>- leader_type: VARCHAR<br/>- location: VARCHAR<br/>- coordinates: GEOGRAPHY<br/>- personality_traits: JSONB]
        
        leader_languages[LEADER_LANGUAGES<br/>- id: UUID PK<br/>- leader_id: FK<br/>- language_code: VARCHAR<br/>- proficiency_level: VARCHAR]
        
        leader_specialties[LEADER_SPECIALTIES<br/>- id: UUID PK<br/>- leader_id: FK<br/>- specialty_name: VARCHAR<br/>- years_experience: INT]
    end
    
    subgraph "Tours & Packages"
        tours[TOURS<br/>- id: UUID PK<br/>- leader_id: FK<br/>- title: VARCHAR<br/>- slug: VARCHAR<br/>- price_per_person: DECIMAL<br/>- coordinates: GEOGRAPHY]
        
        tour_itinerary[TOUR_ITINERARY<br/>- id: UUID PK<br/>- tour_id: FK<br/>- day_number: INT<br/>- activities: JSONB]
        
        tour_schedules[TOUR_SCHEDULES<br/>- id: UUID PK<br/>- tour_id: FK<br/>- start_date: DATE<br/>- end_date: DATE<br/>- status: VARCHAR]
    end
    
    subgraph "Bookings & Payments"
        bookings[BOOKINGS<br/>- id: UUID PK<br/>- booking_type: VARCHAR<br/>- user_id: FK<br/>- tour_id: FK<br/>- leader_id: FK<br/>- status: VARCHAR]
        
        payments[PAYMENTS<br/>- id: UUID PK<br/>- booking_id: FK<br/>- amount: DECIMAL<br/>- payment_method: VARCHAR<br/>- status: VARCHAR]
    end
    
    subgraph "Reviews & Content"
        reviews[REVIEWS<br/>- id: UUID PK<br/>- reviewer_id: FK<br/>- reviewable_type: VARCHAR<br/>- rating: INT<br/>- comment: TEXT]
        
        travel_stories[TRAVEL_STORIES<br/>- id: UUID PK<br/>- author_id: FK<br/>- title: VARCHAR<br/>- content: TEXT<br/>- personality_traits: JSONB]
        
        story_likes[STORY_LIKES<br/>- story_id: FK<br/>- user_id: FK]
    end
    
    subgraph "Personality Matching"
        personality_types[PERSONALITY_TYPES<br/>- id: UUID PK<br/>- type_name: VARCHAR<br/>- traits: JSONB]
        
        user_quiz_results[USER_QUIZ_RESULTS<br/>- id: UUID PK<br/>- user_id: FK<br/>- personality_type_id: FK<br/>- result_traits: JSONB]
        
        personality_match_scores[MATCH_SCORES<br/>- user_id: FK<br/>- leader_id: FK<br/>- match_percentage: INT]
    end
    
    subgraph "Communication"
        messages[MESSAGES<br/>- id: UUID PK<br/>- sender_id: FK<br/>- recipient_id: FK<br/>- content: TEXT]
        
        notifications[NOTIFICATIONS<br/>- id: UUID PK<br/>- user_id: FK<br/>- type: VARCHAR<br/>- message: TEXT]
    end
    
    subgraph "Supporting Tables"
        certifications[CERTIFICATIONS<br/>- id: UUID PK<br/>- leader_id: FK<br/>- name: VARCHAR<br/>- issuer: VARCHAR]
        
        user_favorites[USER_FAVORITES<br/>- user_id: FK<br/>- favoritable_type: VARCHAR<br/>- tour_id: FK<br/>- leader_id: FK]
        
        invitation_codes[INVITATION_CODES<br/>- code: VARCHAR<br/>- max_uses: INT]
        
        promo_codes[PROMO_CODES<br/>- code: VARCHAR<br/>- discount_type: VARCHAR<br/>- discount_value: DECIMAL]
    end
    
    %% Relationships
    users -->|1:1| tour_leaders
    users -->|1:N| bookings
    users -->|1:N| reviews
    users -->|1:N| travel_stories
    users -->|1:N| messages
    users -->|1:N| notifications
    users -->|1:N| user_quiz_results
    users -->|1:N| user_favorites
    
    tour_leaders -->|1:N| tours
    tour_leaders -->|1:N| leader_languages
    tour_leaders -->|1:N| leader_specialties
    tour_leaders -->|1:N| certifications
    tour_leaders -->|1:N| bookings
    tour_leaders -->|1:N| personality_match_scores
    
    tours -->|1:N| tour_itinerary
    tours -->|1:N| tour_schedules
    tours -->|1:N| bookings
    tours -->|1:N| reviews
    
    tour_schedules -->|1:N| bookings
    
    bookings -->|1:N| payments
    bookings -->|1:N| messages
    
    travel_stories -->|1:N| story_likes
    
    personality_types -->|1:N| user_quiz_results
    
    style users fill:#e8f4fd
    style tour_leaders fill:#fff4e6
    style tours fill:#f0f9ff
    style bookings fill:#fef3c7
    style reviews fill:#ecfdf5
    style personality_types fill:#fce7f3